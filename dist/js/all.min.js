var map,infowindow,locations=[],initApp=function(){function e(e,o,n,t,s,r,i,a){var l=this;l.title=e,l.latitude=n,l.content=o,l.longitude=t,l.stats=s,l.imgURL="",l.venueID=r,l.venueIndex=i,l.mapIcon=a}function o(){var e=this;map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.835105,lng:-73.945388},zoom:14}),infowindow=new google.maps.InfoWindow,map.set("styles",i),e.locations=ko.observableArray(locations),e.currentFilter=ko.observable(),e.searchFilter=ko.observable(),e.categoryFilter=ko.observable(),e.setFilter=function(o,n){e.currentFilter(o)},e.results=ko.observable(0),e.setMarkers=ko.computed(function(){ko.utils.arrayForEach(this.locations(),function(e){e.marker||(e.marker=new google.maps.Marker({position:{lat:Number(e.latitude),lng:Number(e.longitude)},map:map,title:e.title,animation:google.maps.Animation.DROP,icon:r[e.mapIcon].icon}),e.marker.setMap(null),e.clickFunc(),n(e.venueIndex,e.venueID))})},e),e.filteredMarkers=function(){var o=0;if("search"==e.currentFilter()){if(e.searchFilter()){var n=e.searchFilter(),t=new RegExp(n,"ig");return o=0,e.results(o),ko.utils.arrayFilter(e.locations(),function(n){return n.marker.title.match(t)?(n.marker.setMap(map),o++,e.results(o),!0):void n.marker.setMap(null)})}return ko.utils.arrayForEach(e.locations(),function(e){e.marker.setMap(map)}),o=e.locations().length,e.results(o),e.locations()}},e.filter=function(o){e.setFilter("category"),e.categoryFilter(o)},e.activateMarker=function(e,o){e.showInfoPanel()}}function n(e,o){$.ajax({url:y(o),data:"",dataType:"json",success:function(o){var n,t,s;o.response.photos.items.length&&(t=o.response.photos.items[0].prefix,n=o.response.photos.items[0].suffix,s=t+"200x200"+n,extraCreditViewModel.locations()[e].imgURL=s)},error:function(e,o,n){}})}var t={},s="../images/map-icons/",r={artgallery:{iconType:"Art Gallery",icon:s+"artgallery.png"},museum:{iconType:"Museum",icon:s+"museum.png"},monument:{iconType:"Monument",icon:s+"monument.png"},library:{iconType:"Library",icon:s+"library.png"},university:{iconType:"College & University",icon:s+"university.png"}},i=[{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"poi.school",icon:s+r.library.icon,stylers:[{visibility:"on"}]},{featureType:"poi.school",elementType:"geometry.fill",stylers:[{color:"#A1A0D8"}]},{featureType:"poi.school",elementType:"labels.text.fill",stylers:[{color:"#A9CCE6"}]},{featureType:"poi.school",elementType:"labels.text.stroke",stylers:[{color:"#2B2D2A"},{weight:3}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#E3E4EF"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#2B2D2A"},{weight:2}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#393F42"}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{color:"#E5DAB3"}]},{featureType:"water",stylers:[{color:"#7C9CC5"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#4D565E"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#CAA958"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#2B2D2A"},{weight:2}]},{featureType:"road.highway",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#595B5C"}]},{featureType:"poi.park"}];e.prototype.clickFunc=function(){var e=this;e.marker.addListener("click",function(){e.showInfoPanel()})},e.prototype.showInfoPanel=function(){var e=this,o="",n="";e.content&&(n="<p>"+e.content+"</p>"),null!==e.marker.getAnimation()?e.marker.setAnimation(null):(map.setCenter({lat:e.latitude,lng:e.longitude}),e.marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){e.marker.setAnimation(null),window.setTimeout(function(){o='<div class="info-window-content">',o+='<div class="info-subtitle">Data provided by FourSquare:</div>',o+='<div class="info-title">'+e.title+"</div>",o+='<div class="info-content">',o+=n,o+="<p><ul>",o+="<li>Checkins Count: "+e.stats.checkinsCount+"</li>",o+="<li>Tip Count: "+e.stats.tipCount+"</li>",o+="<li>Users Count: "+e.stats.usersCount+"</li>",o+="</ul></p>",o+="</div>",e.imgURL&&(o+='<img src="'+e.imgURL+'" />'),o+="</div>",infowindow.setContent(o),infowindow.open(map,e.marker),e.marker.setAnimation(null)},200)},600))},extraCreditViewModel=new o;var a=function(){var e,o,n,t=document.getElementById("legend");for(var s in r)e=s.iconType,o=s.icon,n=document.createElement("div"),n.innerHTML='<img src="'+r[s].icon+'"> '+r[s].iconType,t.appendChild(n)};a();var l="40.835105,-73.945388",c="800",p="10",u="20151107",m=["museum","university","library","monument","artgallery"],d="https://api.foursquare.com/v2/multi?client_id=XV0OVKSTK15ITPVJOMDIBPZYBYEI5OOKSXD0GTH4JFKIXYWZ&client_secret=GRYWQV4WWFFVJ3VQPJX4TLMBCPXP3BFCPH4IWZGUTM4MCORP&v="+u+"&requests="+encodeURIComponent("/venues/search?v="+u+"&ll="+encodeURIComponent(l)+"&radius="+c+"&categoryId=4bf58dd8d48988d181941735&limit="+p)+encodeURIComponent(",/venues/search?v="+u+"&ll="+encodeURIComponent(l)+"&radius="+c+"&categoryId=4d4b7105d754a06372d81259&limit="+p)+encodeURIComponent(",/venues/search?v="+u+"&ll="+encodeURIComponent(l)+"&radius="+c+"&categoryId=4bf58dd8d48988d12f941735&limit="+p)+encodeURIComponent(",/venues/search?v="+u+"&ll="+encodeURIComponent(l)+"&radius="+c+"&categoryId=4bf58dd8d48988d12d941735&limit="+p)+encodeURIComponent(",/venues/search?v="+u+"&ll="+encodeURIComponent(l)+"&radius="+c+"&categoryId=4bf58dd8d48988d1e2931735&limit="+p),y=function(e){return"https://api.foursquare.com/v2/venues/"+e+"/photos?client_id=XV0OVKSTK15ITPVJOMDIBPZYBYEI5OOKSXD0GTH4JFKIXYWZ&client_secret=GRYWQV4WWFFVJ3VQPJX4TLMBCPXP3BFCPH4IWZGUTM4MCORP&v=20151107&limit=1"};t.fourSquare=function(o){$.ajax({url:d,data:"",dataType:"json",success:function(o){console.log(o);var n,t,s,r,i,a,l,c,p=o.response.responses.length,u=0;for(response=0;response<p;response++)for(venuesFound=o.response.responses[response].response.venues.length,c=0;c<venuesFound;c++)n=o.response.responses[response].response.venues[c].id,t=o.response.responses[response].response.venues[c].name,s=o.response.responses[response].response.venues[c].location.address,r=o.response.responses[response].response.venues[c].location.lat,i=o.response.responses[response].response.venues[c].location.lng,a=o.response.responses[response].response.venues[c].stats,l=m[response],extraCreditViewModel.locations.push(new e(t,s,r,i,a,n,u,l)),u++},error:function(e,o,n){},complete:function(e,o){}})},t.fourSquare(),ko.applyBindings(extraCreditViewModel)};$(document).ready(function(){$('[data-toggle="offcanvas"]').click(function(){$(".row-offcanvas").toggleClass("active")})});